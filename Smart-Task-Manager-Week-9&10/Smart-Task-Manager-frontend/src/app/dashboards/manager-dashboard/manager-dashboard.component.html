<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Manager Dashboard</h1>
    <button (click)="logout()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
      Logout
    </button>
  </div>

  <!-- Main content split into two columns for larger screens -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Task Creation Form -->
    <div class="bg-white shadow-md rounded-lg p-6">
      <h2 class="text-2xl font-semibold mb-4">Create New Task</h2>
      <!-- Reusable task form component -->
      <!-- Passes employee list via [employees] input property -->
      <!-- Emits a 'taskCreated' event which triggers onTaskCreated() in TS -->
      <app-task-form [employees]="employees" (taskCreated)="onTaskCreated()"></app-task-form>
    </div>


    <!-- Completion per employee bar chart -->
    <div style="width: 70%; margin: auto;">
      <canvas baseChart [data]="completionData" [options]="barChartOptions" chartType="barChartType">
      </canvas>
    </div>

    <!-- Task List -->
    <div class="bg-white shadow-md rounded-lg p-6">
      <h2 class="text-2xl font-semibold mb-4">Your Tasks</h2>

      <!-- ðŸ”¹ Search box for filtering tasks -->
      <div class="mb-4">
        <input type="text" placeholder="Search tasks..." [(ngModel)]="searchTerm" (input)="filterTasks()"
          class="border border-gray-300 rounded-md px-3 py-2 w-full sm:w-1/2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>

      <!-- If there are tasks, loop and display them -->
      <div *ngIf="tasks.length > 0" class="space-y-4">
        <div *ngFor="let task of tasks" class="p-4 bg-gray-100 rounded-lg shadow-sm">
          <h3 class="text-lg font-bold">{{ task.title }}</h3>
          <p class="text-sm text-gray-600">Status: {{ task.status }}</p>
          <p class="text-sm text-gray-600">Due Date: {{ task.dueDate | date }}</p>
          <!-- Display assigned employees -->
          <p class="text-sm text-gray-600">
            Assigned to:
            <!-- If there are assignees, list them separated by commas -->
            <span *ngIf="task.assignees && task.assignees.length > 0">
              <span *ngFor="let assignee of task.assignees; let last = last">
                {{ assignee.username }}{{ !last ? ', ' : '' }}
              </span>
            </span>
            <!-- If no assignees, show a message -->
            <span *ngIf="!task.assignees || task.assignees.length === 0">
              No assignees
            </span>
          </p>
        </div>
      </div>
      <!-- If there are no tasks, show empty state message -->
      <div *ngIf="tasks.length === 0" class="text-gray-500">
        No tasks found.
      </div>
    </div>

    <!-- Report filters -->
    <h3>Generate Report</h3>
    <div class="filters">
      <label>Status:
        <select [(ngModel)]="selectedStatus">
          <option value="">All</option>
          <option>To Do</option>
          <option>In Progress</option>
          <option>Completed</option>
        </select>
      </label>

      <label>Assignee ID:
        <input type="number" [(ngModel)]="assigneeId">
      </label>

      <label>Start Date:
        <input type="date" [(ngModel)]="startDate">
      </label>

      <label>End Date:
        <input type="date" [(ngModel)]="endDate">
      </label>
    </div>

    <div class="actions">
      <button (click)="downloadReport('pdf')">Download PDF</button>
      <button (click)="downloadReport('excel')">Download Excel</button>
    </div>
  </div>